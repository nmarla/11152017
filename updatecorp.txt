USE [CTSDEV]
GO

/****** Object:  StoredProcedure [dbo].[SP_UpdateCorp]    Script Date: 11/15/2017 19:38:02 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

create PROCEDURE [dbo].[SP_UpdateCorp]
   (
            @cc_number int   
           ,@purpose_of_contact varchar(20)
           ,@poc_other varchar(20)
           ,@cc_recdin varchar(20)
           ,@date_entered datetime
           ,@date_recd datetime
           ,@recd_by int
           ,@cc_date datetime
     ,@cc_status varchar(20)
        ,@serv_req_number varchar(50)
   )

AS
BEGIN
if @cc_number = 0
begin
INSERT INTO [dbo].[CorrCompInfo]
           (
           [purpose_of_contact]
           ,[poc_other]
           ,[cc_recdin]
           ,[date_entered]
           ,[date_recd]
           ,[recd_by]
           ,[cc_date]
     ,[cc_status]
     ,[serv_req_number])
     VALUES
           (
       
           @purpose_of_contact
           ,@poc_other
           ,@cc_recdin
           ,@date_entered
           ,@date_recd
           ,@recd_by
           ,@cc_date
     ,@cc_status
        ,@serv_req_number
     )
END
ELSE
BEGIN
 
UPDATE [dbo].[CorrCompInfo]
   SET [purpose_of_contact] = @purpose_of_contact
      ,[poc_other] = @poc_other
      ,[cc_recdin] = @cc_recdin
      ,[date_entered] = @date_entered
      ,[date_recd] = @date_recd
      ,[recd_by] = @recd_by
      ,[cc_date] = @cc_date
      ,[cc_status] = @cc_status
      ,[serv_req_number] = @serv_req_number
      
 WHERE cc_number=@cc_number

 END

 END

-- exec SP_UpdateCorp 345,'now','now','now','2017-11-11','2017-11-11',1,'2017-11-11','now','now'
GO



















//////////////////////////////////
   public int InsertData(TrackingViewModel trackingviewmodel)
        {
            try
            {
                CorrCompInfo corrcompinfo = new CorrCompInfo();
                corrcompinfo.cc_number = trackingviewmodel.corrcmpInfo.cc_number;
                corrcompinfo.purpose_of_contact = trackingviewmodel.corrcmpInfo.purpose_of_contact;
                corrcompinfo.cc_recdin = trackingviewmodel.corrcmpInfo.cc_recdin;
                corrcompinfo.date_entered = trackingviewmodel.corrcmpInfo.date_entered.Date;
                corrcompinfo.date_recd = trackingviewmodel.corrcmpInfo.date_recd.Date;
                corrcompinfo.cc_date = DateTime.Now;
                corrcompinfo.recd_by = 1; // trackingviewmodel.corrcmpInfo.cc_recdby
                corrcompinfo.poc_other = trackingviewmodel.corrcmpInfo.poc_other;
                corrcompinfo.cc_status = trackingviewmodel.corrcmpInfo.cc_status;
                corrcompinfo.serv_req_number = trackingviewmodel.corrcmpInfo.serv_req_number;
                 var result = _unitOfWork.Repository<CorrCompInfo>().ExecuteProcedure("SP_Insertcorrcompinfo @cc_number,@purpose_of_contact,@poc_other,@cc_recdin,@date_recd,@recd_by,@date_entered,@cc_date,@cc_status,@serv_req_number",
              //  var result = _unitOfWork.Repository<CorrCompInfo>().ExecuteProcedure("SP_Insertcorrcompinfo",
                             new SqlParameter("@cc_number", SqlDbType.Int) { Value = corrcompinfo.cc_number },
                            new SqlParameter("@purpose_of_contact", SqlDbType.VarChar) { Value = corrcompinfo.purpose_of_contact },
                            new SqlParameter("@poc_other", SqlDbType.VarChar) { Value = corrcompinfo.poc_other },
                            new SqlParameter("@cc_recdin", SqlDbType.VarChar) { Value = corrcompinfo.cc_recdin },
                            new SqlParameter("@date_recd", SqlDbType.Date) { Value =corrcompinfo.date_recd },
                            new SqlParameter("@recd_by", SqlDbType.Int) { Value = corrcompinfo.recd_by },
                            new SqlParameter("@date_entered", SqlDbType.Date) { Value = corrcompinfo.date_entered},
                            new SqlParameter("@cc_date", SqlDbType.Date) { Value = corrcompinfo.cc_date },
                            new SqlParameter("@cc_status", SqlDbType.VarChar) { Value = corrcompinfo.cc_status },
                            new SqlParameter("@serv_req_number", SqlDbType.VarChar) { Value = corrcompinfo.serv_req_number });
                //_unitOfWork.Repository<CorrCompInfo>().Insert(corrcompinfo);
                return result;
            }
            catch (Exception ex)
            {
                return 1;
            }
        }

///////////////////////////////////////////////
<script type="text/javascript">
    $(function () {
        debugger;
       // var poc = $("#corrcompInfo_purpose_of_contact").val();
        var seletes = $("#corrcmpInfo_purpose_of_contact option:selected").text();
       //alert(seletes);
       $('#corrcmpInfo_purpose_of_contact').on('change', function () {
           debugger;
           alert(this.value);
           if (this.value == 'test2') {
               $('#corrcmpInfo_poc_other').show();
           }
           else
           {
               $('#corrcmpInfo_poc_other').hide();
           }
       })

       $("#corrcmpcontactInfo_tel_number").blur(function () {
           debugger;
           var a = this.value;
           //var filter = /^[0-9-+]+$/;
           var filter1=/^\([0-9]{3}\)[0-9]{3}-[0-9]{4}$/;
           if (filter1.test(a)) {
               return true;
           }
       else {
               alert('Please enter correct format');
       }

       });
    });
</script>
